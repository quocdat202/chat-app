{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { useState, useEffect } from 'react';\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport Pressable from \"react-native-web/dist/exports/Pressable\";\nimport FlatList from \"react-native-web/dist/exports/FlatList\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport LogBox from \"react-native-web/dist/exports/LogBox\";\nimport Dimensions from \"react-native-web/dist/exports/Dimensions\";\nimport Platform from \"react-native-web/dist/exports/Platform\";\nimport StatusBar from \"react-native-web/dist/exports/StatusBar\";\nimport nullAvatar from \"../Images/null-avatar.png\";\nimport { db } from \"../Firebase\";\nimport { collection, getDocs, query, where, addDoc, onSnapshot, getDoc } from \"firebase/firestore\";\nimport Friend from \"../Components/Friend\";\nimport { useHeaderHeight } from '@react-navigation/elements';\n;\nimport Icon from \"@expo/vector-icons/Feather\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport default function Home(_ref) {\n  var navigation = _ref.navigation,\n      route = _ref.route;\n\n  var _useState = useState(''),\n      _useState2 = _slicedToArray(_useState, 2),\n      sdt = _useState2[0],\n      setSdt = _useState2[1];\n\n  var _useState3 = useState(null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      searchUser = _useState4[0],\n      setSearchUser = _useState4[1];\n\n  var _useState5 = useState([]),\n      _useState6 = _slicedToArray(_useState5, 2),\n      rooms = _useState6[0],\n      setRooms = _useState6[1];\n\n  var _useState7 = useState([]),\n      _useState8 = _slicedToArray(_useState7, 2),\n      friends = _useState8[0],\n      setFriends = _useState8[1];\n\n  var _useState9 = useState([]),\n      _useState10 = _slicedToArray(_useState9, 2),\n      messages = _useState10[0],\n      setMessages = _useState10[1];\n\n  var roomsRef = collection(db, \"rooms\");\n  var usersRef = collection(db, \"users\");\n  var messagesRef = collection(db, \"messages\");\n  var user = route.params;\n  LogBox.ignoreLogs(['Setting a timer for a long period of time']);\n  var windowHeight = Dimensions.get('window').height;\n  var headerHeight = useHeaderHeight();\n  useEffect(function _callee2() {\n    var unsub;\n    return _regeneratorRuntime.async(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            unsub = onSnapshot(collection(db, \"messages\"), function _callee() {\n              var q, querySnapshot, arrayMessages;\n              return _regeneratorRuntime.async(function _callee$(_context) {\n                while (1) {\n                  switch (_context.prev = _context.next) {\n                    case 0:\n                      getData();\n                      q = query(messagesRef);\n                      _context.next = 4;\n                      return _regeneratorRuntime.awrap(getDocs(q));\n\n                    case 4:\n                      querySnapshot = _context.sent;\n\n                      if (querySnapshot.docs.length > 0) {\n                        arrayMessages = [];\n                        querySnapshot.docs.forEach(function (doc) {\n                          arrayMessages.push(doc.data());\n                        });\n                        setMessages(arrayMessages);\n                      }\n\n                    case 6:\n                    case \"end\":\n                      return _context.stop();\n                  }\n                }\n              }, null, null, null, Promise);\n            });\n\n          case 1:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }, []);\n  useEffect(function () {\n    var unsub = onSnapshot(collection(db, \"rooms\"), function _callee3() {\n      return _regeneratorRuntime.async(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              getData();\n\n            case 1:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    });\n  }, []);\n\n  var getData = function getData() {\n    var q, querySnapshot, arrayRooms, arrayFriends;\n    return _regeneratorRuntime.async(function getData$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            q = query(roomsRef, where(\"users\", \"array-contains\", user._id));\n            _context4.next = 3;\n            return _regeneratorRuntime.awrap(getDocs(q));\n\n          case 3:\n            querySnapshot = _context4.sent;\n            arrayRooms = [];\n            arrayFriends = [];\n\n            if (querySnapshot.docs.length > 0) {\n              querySnapshot.docs.forEach(function (room) {\n                arrayRooms.push({\n                  id: room.id,\n                  users: room.data().users\n                });\n\n                if (room.data().users[0] === user._id) {\n                  arrayFriends.push({\n                    _id: room.data().users[1],\n                    idRoom: room.id\n                  });\n                } else arrayFriends.push({\n                  _id: room.data().users[0],\n                  idRoom: room.id\n                });\n              });\n            }\n\n            setRooms(arrayRooms);\n            setFriends(arrayFriends);\n\n          case 9:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var searchFriend = function searchFriend() {\n    var q, querySnapshot;\n    return _regeneratorRuntime.async(function searchFriend$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            q = query(usersRef, where(\"_id\", \"==\", sdt));\n            _context5.next = 3;\n            return _regeneratorRuntime.awrap(getDocs(q));\n\n          case 3:\n            querySnapshot = _context5.sent;\n\n            if (querySnapshot.docs.length > 0) {\n              if (querySnapshot.docs[0].data()._id !== user._id) setSearchUser(querySnapshot.docs[0].data());\n            }\n\n          case 5:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var getIdRoom = function getIdRoom(_id) {\n    var idRoom = null;\n    friends.forEach(function (friend) {\n      if (_id === friend._id) idRoom = friend.idRoom;\n    });\n    return idRoom;\n  };\n\n  var createRoom = function createRoom() {\n    var idRoom, newRoom;\n    return _regeneratorRuntime.async(function createRoom$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            idRoom = getIdRoom(searchUser._id);\n\n            if (!idRoom) {\n              _context6.next = 5;\n              break;\n            }\n\n            navigation.navigate('Chat', {\n              idRoom: idRoom,\n              user: user,\n              navigation: navigation\n            });\n            _context6.next = 9;\n            break;\n\n          case 5:\n            _context6.next = 7;\n            return _regeneratorRuntime.awrap(addDoc(roomsRef, {\n              users: [user._id, searchUser._id]\n            }));\n\n          case 7:\n            newRoom = _context6.sent;\n            navigation.navigate('Chat', {\n              idRoom: newRoom.id,\n              user: user,\n              navigation: navigation\n            });\n\n          case 9:\n            setSearchUser(null);\n\n          case 10:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var checkMessage = function checkMessage(idRoom) {\n    var result = false;\n    messages.forEach(function (element) {\n      if (element.idRoom === idRoom) result = true;\n    });\n    return result;\n  };\n\n  return _jsxs(View, {\n    style: styles.container,\n    children: [_jsxs(View, {\n      style: styles.header,\n      children: [_jsxs(View, {\n        style: {\n          display: 'flex',\n          flexDirection: 'row',\n          alignItems: 'center'\n        },\n        children: [_jsx(Image, {\n          style: styles.avatar,\n          resizeMode: \"center\",\n          source: nullAvatar\n        }), _jsx(Text, {\n          style: styles.nameUser,\n          children: user.name + '(' + user._id + ')'\n        })]\n      }), _jsx(Icon, {\n        style: styles.logOut,\n        name: \"log-out\",\n        size: 35,\n        onPress: function onPress() {\n          return navigation.navigate('Login');\n        }\n      })]\n    }), _jsxs(View, {\n      style: styles.search,\n      children: [_jsx(TextInput, {\n        style: styles.inputSearch,\n        keyboardType: \"numeric\",\n        placeholder: \"T\\xECm b\\u1EA1n b\\xE8\",\n        onChangeText: function onChangeText(val) {\n          setSdt(val);\n          /[^0-9]/.test(val) ? alert('Vui lòng chỉ nhập số!') : \" \";\n        }\n      }), _jsx(Icon, {\n        style: styles.iconSearch,\n        size: 35,\n        name: \"search\",\n        onPress: function onPress() {\n          return searchFriend();\n        }\n      })]\n    }), searchUser ? _jsxs(View, {\n      style: styles.userSeacrh,\n      children: [_jsxs(View, {\n        style: {\n          flexDirection: 'row',\n          alignItems: 'center'\n        },\n        children: [_jsx(Image, {\n          style: styles.avatar,\n          source: nullAvatar\n        }), _jsx(Text, {\n          style: {\n            marginLeft: 7\n          },\n          children: searchUser.name\n        })]\n      }), _jsxs(View, {\n        style: {\n          flexDirection: 'row',\n          alignItems: 'center'\n        },\n        children: [_jsx(Pressable, {\n          onPress: function onPress() {\n            return createRoom();\n          },\n          style: {\n            backgroundColor: '#596CE5',\n            borderRadius: 7,\n            padding: 10,\n            marginRight: 10\n          },\n          children: _jsx(Text, {\n            style: {\n              color: '#FFFFFF'\n            },\n            children: \"Nh\\u1EAFn tin\"\n          })\n        }), _jsx(Pressable, {\n          onPress: function onPress() {\n            return setSearchUser(null);\n          },\n          style: {\n            backgroundColor: '#C72016',\n            borderRadius: 7,\n            padding: 10\n          },\n          children: _jsx(Text, {\n            style: {\n              color: '#FFFFFF'\n            },\n            children: \"X\\xF3a\"\n          })\n        })]\n      })]\n    }) : null, _jsx(View, {\n      style: styles.body,\n      children: _jsx(FlatList, {\n        data: rooms,\n        renderItem: function renderItem(_ref2) {\n          var item = _ref2.item;\n          return checkMessage(item.id) ? _jsx(Friend, {\n            _id: item.users[0] === user._id ? item.users[1] : item.users[0],\n            _idUser: user._id,\n            navigation: navigation,\n            idRoom: item.id,\n            user: user,\n            messages: messages\n          }) : null;\n        },\n        style: styles.listUser\n      })\n    })]\n  });\n}\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: '#C9C9C9',\n    alignItems: 'center',\n    justifyContent: 'center'\n  },\n  header: {\n    flexDirection: 'row',\n    backgroundColor: '#FFFFFF',\n    width: '100%',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    padding: 20\n  },\n  avatar: {\n    width: 50,\n    height: 50,\n    borderRadius: 50\n  },\n  nameUser: {\n    fontSize: 15,\n    fontWeight: \"500\",\n    marginLeft: 10\n  },\n  body: {\n    width: '100%',\n    flex: 1\n  },\n  listUser: {\n    width: '100%',\n    backgroundColor: '#FFFFFF',\n    flex: 1\n  },\n  search: {\n    margin: 10,\n    backgroundColor: '#F8F8FC',\n    padding: 15,\n    justifyContent: 'space-between',\n    width: '100%',\n    flexDirection: 'row'\n  },\n  inputSearch: {\n    backgroundColor: '#FFFFFF',\n    padding: 7,\n    width: '85%',\n    borderRadius: 10\n  },\n  userSeacrh: {\n    padding: 10,\n    backgroundColor: '#FFFFFF',\n    width: '100%',\n    margin: 10,\n    borderRadius: 10,\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    flexDirection: 'row',\n    justifyContent: 'space-between'\n  },\n  iconSearch: {\n    height: '100%',\n    alignContent: 'flex-start',\n    color: 'blue'\n  },\n  logOut: {\n    justifyContent: 'center',\n    alignSelf: 'center',\n    color: 'red'\n  }\n});","map":{"version":3,"sources":["D:/Đồ án web/chat-app/Pages/Home.js"],"names":["useState","useEffect","nullAvatar","db","collection","getDocs","query","where","addDoc","onSnapshot","getDoc","Friend","useHeaderHeight","Icon","Home","navigation","route","sdt","setSdt","searchUser","setSearchUser","rooms","setRooms","friends","setFriends","messages","setMessages","roomsRef","usersRef","messagesRef","user","params","LogBox","ignoreLogs","windowHeight","Dimensions","get","height","headerHeight","unsub","getData","q","querySnapshot","docs","length","arrayMessages","forEach","doc","push","data","_id","arrayRooms","arrayFriends","room","id","users","idRoom","searchFriend","getIdRoom","friend","createRoom","navigate","newRoom","checkMessage","result","element","styles","container","header","display","flexDirection","alignItems","avatar","nameUser","name","logOut","search","inputSearch","val","test","alert","iconSearch","userSeacrh","marginLeft","backgroundColor","borderRadius","padding","marginRight","color","body","item","listUser","StyleSheet","create","flex","justifyContent","width","fontSize","fontWeight","margin","alignContent","alignSelf"],"mappings":"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","sourcesContent":["import {useState , useEffect} from 'react';\r\nimport { StyleSheet, Text, View , Image ,Pressable ,FlatList ,TextInput , Button, LogBox, Dimensions, Platform, StatusBar  } from 'react-native';\r\nimport nullAvatar from '../Images/null-avatar.png';\r\nimport { db } from '../Firebase';\r\nimport { collection, getDocs , query , where , addDoc , onSnapshot, getDoc} from \"firebase/firestore\";\r\nimport Friend from '../Components/Friend';\r\nimport { useHeaderHeight } from '@react-navigation/elements';;\r\nimport Icon from 'react-native-vector-icons/Feather';\r\n\r\n\r\nexport default function Home({navigation,route}){\r\n  const [sdt, setSdt] = useState('');\r\n  const [searchUser, setSearchUser] = useState(null);\r\n  const [rooms, setRooms] = useState([]);\r\n  const [friends, setFriends] = useState([]);\r\n  const [messages, setMessages] = useState([])\r\n  const roomsRef = collection(db ,\"rooms\");\r\n  const usersRef = collection(db,\"users\");\r\n  const messagesRef = collection(db, \"messages\");\r\n  const user = route.params;\r\n  LogBox.ignoreLogs(['Setting a timer for a long period of time'])\r\n\r\n  const windowHeight = Dimensions.get('window').height;\r\n\r\n  const headerHeight = useHeaderHeight();\r\n\r\n  useEffect(async () => {\r\n    const unsub = onSnapshot(collection(db, \"messages\"),async () => {\r\n      getData();\r\n      const q = query(messagesRef);\r\n      const querySnapshot = await getDocs(q);\r\n      if(querySnapshot.docs.length > 0 ){\r\n          var arrayMessages = [];\r\n          querySnapshot.docs.forEach((doc) => {\r\n              arrayMessages.push(doc.data());\r\n          })\r\n          setMessages(arrayMessages)\r\n      }\r\n  });\r\n  }, [])\r\n  useEffect(() => {\r\n    const unsub = onSnapshot(collection(db, \"rooms\"),async () => {\r\n      getData();\r\n  });\r\n  }, [])\r\n  const getData = async () => {\r\n    const q = query(roomsRef , where(\"users\",\"array-contains\",user._id));\r\n      const querySnapshot = await getDocs(q);\r\n      var arrayRooms = [];\r\n      var arrayFriends = [];\r\n      if(querySnapshot.docs.length > 0) {\r\n        querySnapshot.docs.forEach((room)=>{\r\n          arrayRooms.push({id : room.id , users  : room.data().users});\r\n          if(room.data().users[0] === user._id) {\r\n              arrayFriends.push({\r\n                    _id : room.data().users[1],\r\n                    idRoom : room.id\r\n             })\r\n          }else arrayFriends.push({\r\n              _id : room.data().users[0],\r\n              idRoom : room.id\r\n          })\r\n        })\r\n      }\r\n      setRooms(arrayRooms);\r\n      setFriends(arrayFriends);\r\n  }\r\n  const searchFriend = async () => {\r\n      const q = query(usersRef , where(\"_id\",\"==\",sdt));\r\n      const querySnapshot = await getDocs(q);\r\n      if(querySnapshot.docs.length > 0){\r\n        if(querySnapshot.docs[0].data()._id !== user._id)  setSearchUser(querySnapshot.docs[0].data());\r\n      }\r\n  }\r\n  const getIdRoom = (_id) => {\r\n      var idRoom = null;\r\n      friends.forEach((friend) => {\r\n         if(_id === friend._id) idRoom = friend.idRoom;\r\n      })\r\n      return idRoom;\r\n  }\r\n  const createRoom = async () =>{\r\n    const idRoom = getIdRoom(searchUser._id);\r\n    if(idRoom){\r\n        navigation.navigate('Chat',{idRoom : idRoom , user : user , navigation : navigation})\r\n    }else{\r\n      const newRoom = await addDoc(roomsRef, {\r\n        users : [user._id , searchUser._id]\r\n      });\r\n        navigation.navigate('Chat',{ idRoom : newRoom.id , user : user , navigation : navigation})\r\n    }\r\n    setSearchUser(null);\r\n  }\r\n  const checkMessage =  (idRoom) => {\r\n      var result = false;\r\n      messages.forEach(element => {\r\n          if(element.idRoom === idRoom) result = true;\r\n      });\r\n      return result;\r\n  }\r\n  return(\r\n    <View style={styles.container}>\r\n          <View style={styles.header}>\r\n                <View style={{display : 'flex' ,flexDirection :'row',alignItems :'center'}}>\r\n                    <Image style={styles.avatar} resizeMode='center' source={nullAvatar} />\r\n                    <Text style={styles.nameUser}>{user.name + '(' +user._id + ')'}</Text>\r\n                </View>\r\n                <Icon style={styles.logOut} name='log-out' size={35} onPress={()=>navigation.navigate('Login')}></Icon>\r\n          </View>\r\n          <View style={styles.search}>\r\n              <TextInput style={styles.inputSearch} keyboardType='numeric' placeholder='Tìm bạn bè' onChangeText= {(val) => {setSdt(val); /[^0-9]/.test(val)?alert('Vui lòng chỉ nhập số!'):\" \"}  }></TextInput>\r\n              <Icon style={styles.iconSearch} size={35} name='search' onPress={()=>searchFriend()}></Icon>\r\n          </View>\r\n          {\r\n            searchUser ? \r\n              <View style={ styles.userSeacrh}>\r\n                   <View style={{flexDirection : 'row',alignItems :'center'}}>\r\n                      <Image style={styles.avatar} source={nullAvatar} />\r\n                      <Text style={{marginLeft : 7}} >{searchUser.name}</Text>\r\n                  </View>\r\n                  <View style={{flexDirection : 'row',alignItems : 'center'}}>\r\n                      <Pressable onPress={()=>createRoom()} style={{ backgroundColor : '#596CE5',borderRadius :7 , padding : 10 , marginRight : 10}}>\r\n                                <Text style={{color :'#FFFFFF'}}>Nhắn tin</Text>\r\n                      </Pressable>\r\n                      <Pressable onPress={()=>setSearchUser(null)} style={{ backgroundColor : '#C72016',borderRadius :7 , padding : 10}}>\r\n                                <Text style={{color :'#FFFFFF'}}>Xóa</Text>\r\n                      </Pressable>\r\n                  </View>\r\n\r\n              </View>\r\n              : null\r\n          }\r\n          <View style={styles.body}>\r\n              <FlatList  \r\n                      data={rooms}\r\n                      renderItem={({item}) =>\r\n                        checkMessage(item.id) ? <Friend _id={item.users[0] === user._id ? item.users[1] : item.users[0]} _idUser={user._id} navigation={navigation} idRoom={item.id} user={user} messages={messages}/>\r\n                          : null\r\n                      }\r\n                      style={styles.listUser}>\r\n              </FlatList>\r\n          </View>\r\n    </View>\r\n  );\r\n}\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#C9C9C9',\r\n    alignItems: 'center',\r\n    justifyContent: 'center'\r\n  },\r\n  header : {\r\n    flexDirection : 'row',\r\n    backgroundColor : '#FFFFFF',\r\n    width : '100%',\r\n    alignItems : 'center',\r\n    justifyContent : 'space-between',\r\n    padding : 20\r\n  },\r\n  avatar : {\r\n    width : 50 ,\r\n    height :50 ,\r\n    borderRadius : 50\r\n  },\r\n  nameUser : {\r\n    fontSize : 15,\r\n    fontWeight : \"500\",\r\n    marginLeft : 10\r\n  },\r\n  body : {\r\n    width : '100%',\r\n    flex : 1,\r\n  },\r\n  listUser : {\r\n    width : '100%',\r\n    backgroundColor : '#FFFFFF',\r\n    flex : 1 \r\n  },\r\n  search : {\r\n    margin : 10,\r\n    backgroundColor: '#F8F8FC',\r\n    padding : 15 ,\r\n    justifyContent : 'space-between',\r\n    width : '100%',\r\n    flexDirection : 'row',\r\n  },\r\n  inputSearch : {\r\n    backgroundColor : '#FFFFFF',\r\n    padding : 7 ,\r\n    width : '85%',\r\n    borderRadius : 10\r\n  },\r\n  userSeacrh : {\r\n    padding  : 10 ,\r\n    backgroundColor : '#FFFFFF',\r\n    width : '100%',\r\n    margin : 10 ,\r\n    borderRadius : 10 ,\r\n    alignItems : 'center',\r\n    justifyContent : 'space-between',\r\n    flexDirection : 'row',\r\n    justifyContent : 'space-between',\r\n  },\r\n  iconSearch : {\r\n    height: '100%',\r\n    alignContent: 'flex-start',\r\n    color: 'blue',\r\n\r\n  },\r\n  logOut : {\r\n    justifyContent: 'center',\r\n    alignSelf: 'center',\r\n    color: 'red'\r\n  }\r\n});\r\n"]},"metadata":{},"sourceType":"module"}